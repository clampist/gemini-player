## Gemini Homepage Playwright Tests

This project houses a Playwright automation suite that exercises key unauthenticated flows on gemini.google.com: the chat surface (English/Japanese prompts, redo, copy), script-like input handling and search empty states, plus settings for locale/theme toggling.

### Prerequisites

- Node.js 18 or newer
- npm 9 or newer

### Install

```bash
npm install
```

### Run Tests

```bash
npm test
```

#### Useful Variants

- `npm run test:headed` — executes tests in a visible browser window.
- `npm run test:ui` — opens the Playwright test runner UI for debugging.
- `npm run test:report` — opens the latest HTML report generated by the last run.

### Project Layout

This project uses the **Page Object pattern** for clean, maintainable test code:

```
tests/
├── chat.spec.ts                  (Chat test - pure business logic)
├── search.spec.ts                (Search test - pure business logic)
├── settings.spec.ts              (Settings test - pure business logic)
├── pages/
│   ├── GeminiChatPage.ts         (Chat page interactions)
│   ├── GeminiSearchPage.ts       (Search page interactions)
│   └── GeminiSettingsPage.ts     (Settings page interactions)
├── support/
│   ├── artifacts.ts              (Screenshot & text helpers)
│   ├── logger.ts                 (Logging utilities)
│   └── utils.ts                  (Common utilities)
└── data/
    └── selectors.ts              (Centralized selectors)
```

**Key Files:**
- `playwright.config.ts` — shared Playwright configuration with Gemini base URL.
- `tests/pages/` — Page Object classes that encapsulate page interactions, selectors, and wait strategies.
- `tests/*.spec.ts` — test files that focus on business scenarios using Page Objects.
- `tests/support/` — reusable utilities for logging, screenshots, and common operations.
- `tests/data/selectors.ts` — central place for selectors and data-test-ids.
- `env.example` — sample environment variables (copy to `.env` for overrides).

### Artifacts

- `artifacts/` — curated screenshots and text snippets grouped by suite (populated via helpers in `tests/support/artifacts.ts`).
- `test-results/` — raw Playwright output per run (auto-generated, safe to delete).
- `playwright-report/` — latest HTML report (`npm run test:report` opens it).
- `logs/` — aggregated Playwright logs generated via helpers in `tests/support/logger.ts`.

### Configuration

Copy `env.example` to `.env` and fill in environment-specific values:

- `ENV` — friendly label for the target environment (optional, available to tests via `process.env`).
- `BASE_URL` — front-end entry point under test.
- `HEADLESS` — toggle headless mode (`true`/`false`); defaults to `true` in CI.

`playwright.config.ts` focuses on framework behaviour (timeouts, reporters, browser settings) and only reads the environment variables above to decide **what** to test.

### Continuous Integration

A GitHub Actions workflow (`.github/workflows/playwright.yml`) runs on pushes and pull requests targeting `main`. It installs Playwright browsers, executes `npm test`, and uploads two artifacts:

- `playwright-report` — download and open `index.html` locally to inspect the run.
- `screenshots` — raw PNG files captured during the suite.

Artifacts are retained for seven days; adjust `retention-days` inside the workflow if you need a longer window.

### Writing Tests with Page Objects

Example test structure:

```typescript
import { test } from '@playwright/test';
import { GeminiChatPage } from './pages/GeminiChatPage';

test('Ask Gemini and validate response', async ({ page }) => {
  const chatPage = new GeminiChatPage(page, test.info());

  await test.step('Open chat', async () => {
    await chatPage.open();
  });

  await test.step('Submit prompt', async () => {
    await chatPage.submitPrompt('Tell me about AI');
  });

  await test.step('Validate response', async () => {
    await chatPage.expectResponseAt(0, /AI|artificial intelligence/i);
    await chatPage.takeScreenshot('ai-response');
  });
});
```

**Best Practices:**
- Initialize Page Object with `page` and `test.info()` for automatic logging
- Use `test.step()` to organize test scenarios
- Page Object methods handle all selectors, waits, and retries
- Tests focus on business logic, not implementation details

For detailed Page Object documentation, see [tests/pages/README.md](../tests/pages/README.md).

### Notes

- The search flow relies on common Gemini selectors. If the public site changes, update the locators in `tests/data/selectors.ts`.
- Browser binaries are managed via `npx playwright install`. Re-run the command if you delete the Playwright cache.

